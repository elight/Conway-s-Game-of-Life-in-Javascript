<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Game of Life</title>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
  <script type="text/javascript" src="underscore.js"></script>
  <script type="text/javascript" src="cell_ecology.js"></script>
  <script type="text/javascript" src="game_of_life_grid.js"></script>
  <style>
    body {
      margin: 0 auto;
    }

    table {
      width: 1200px;
      height: 1200px;
    }
  </style>
</head>
<body style="background-color: white;">
</body>
  <table id="grid">
  </table>
  Gen: <label id="gen"></label>
  <script type="text/javascript">
    var lifewiki_str = (<here><![CDATA[
........................................OO
........................................OO
........................................OO
........................................O
.......................................O.O
.......................................O.OO

..............................................OO
........................................OO....OO
........................................OO

............................................................O..........................OO
..................................................OO........OOO........................O
..................................................O.O..........O.....................O.O
..................................................O...........OO...............O.....OO....OO
..............................................................................OO...........OO
...................................................OO.........................O.O
...............................................O...O..O.....................................O
..............................................O..O.OOO.....................................O.O
..............................................OOO.O.......................................O..O
........................................OO.....O.OOO.....................................O..O
........................................OO...........O
........................................OO......................OO.......................O..O
.........................................O......................OO.........................OO
........................................O.O
.......................................OO.O............OOO
.......................................................O
........................................................O
........................................OO
........................................OO.........................................................OOO

.........................................................................OO....................OOO.O..O
..........................................................................O.......OO.........O.OOO
.......................................................................OOO........OO........O......OOO
.......................................................................O....................OO

...............................................................................................OO
.......................................................................................OO.........OO
.......................................................................................OO.......O.O
...........................................OO....................................................O.........................O...................OO
...........................................OO..........................................................................OO..OO.OOO..........OO....OOOO
......................................................................................................OO...............OO....OOOO..........OO..OO.OOO
....................................................................................OO...............OOO...................OO..................O
...........................................OOO..................................OO..OO..OO..........O.O..O..OO
............................................OO..................................O.O..O..OO..........OO..OO..OO
.........................................OO......................................OOO....................OO
...............................O.........OOO......................................OO.............................................OO.........OO
.............................O...O........O.O...................................................................................OO.O........OO
.............................O...O.........OO....................................................................................O
.............................O.O.O...O..........................................................................................O.O
.....................................OO.........................................................................................OO....OOO
...............................OO......O........................................................................................O.OOO...O
...............................OO...O.O...........................................................................................O.O..O
...............................OO...O..........................................................................................O..O
...................................................................................................................................O
..................OO............O.O..........................O............................................................OO
..............OO.O..O.OO.........OO..........................O.O.........................................................O.O
..............OO..O....O.....................................OO............................................................O
...................O
....................O.O....................OO
...........O.........................OO....OO...........................................................................................OO
...........OOO.......................OO....................................................OOO..........................................O
..............O............................................................................O..........................................O.O
.............OO...........................OOO...............................................O.........................................OO
..........................................OO.................................................................................OO
................................OO...........OO..............................................................................OO
................................OO..........OOO
...........................................O.O
................O..........................OO
..............OO
...............OO
..................................................................................................................OO
...................................................................................................................O
...................................................................................................................O.O
...............................OO...................................................................................OO
...............................O.O
.................................O
.................................OO
....................................................................................................................................OO
.....................................................................................................................................OO
........................................................................................................OO..........................O
.......................................................................................................O.O
......................................................................................................OOO..........OO
......................OO..............................................................................OO...........OO
......................OO.................................................................................OO
.............OO.........................................O...............................................OOO...........................OO
............O.O..........................................O............................................................................O
............O..........................................OOO....................................................OO.......................OOO
...........OO...........................................................................................OO....OO.........................O
........................................................................................................OO....................O.O
.................................................................................................................................O
.........................O............................................................OO.....................................O....O..OO
.........................O.O.........................................................O.O..........................OO.........OO.O..O.OO
.........................OO............................................................O..........................O.O............OO
.................O
..................O..O..........................................................................................O...OO
.............O..O.O...........................................................................................O.O...OO
............O...OOO.O........................................................................................O......OO
............OOO....OO.........................................................................................OO
..................O.O..........................................................................................O...O.O.O
...................O....................................................................................OO.........O...O
.......OO........O.OO...................................................................................O.O........O...O
.......OO.........OO.............................................OO......................................OOO.........O
...........................................OO....................OOO......................................OO
.......................................OO..OO..OO..........OO..O..O.O..................................OO
.......................................OO..O..O.O..........OO..OO..OO..................................OOO
.....O..................OO...................OOO...............OO
OOO.OO..OO..........OOOO....OO...............OO
OOOO....OO..........OOO.OO..OO..........................................................................OO
....OO...................O.........................O....................................................OO
..................................................O.O.......OO
.................................................OO.........OO
....................................................OO

.......................................................OO....................O
...............................................OOO......O........OO........OOO
...................................................OOO.O.........OO.......O
..............................................O..O.OOO....................OO

...............................................OOO.........................................................OO
...........................................................................................................OO
............................................................................................O
.............................................................................................O
...........................................................................................OOO............O.OO
..........................................................................................................O.O
........................................................OO.........................OO......................O
........................................................O..O.......................OO......................OO
...............................................................................................O...........OO
........................................................O..O.....................................OOO.O.....OO
.......................................................O..O.......................................O.OOO
.......................................................O.O.....................................OOO.O..O
........................................................O.....................................O..O...O
....................................................................O.O.........................OO
........................................................OO...........OO
........................................................OO....OO.....O...............OO...........O
.............................................................O.O.....................O..........O.O
.............................................................O........................OOO........OO
............................................................OO..........................O

...........................................................................................................OO
.....................................................................................................OO....OO
.....................................................................................................OO

..........................................................................................................OO.O
...........................................................................................................O.O
............................................................................................................O
...........................................................................................................OO
...........................................................................................................OO
...........................................................................................................OO
]]></here>).toString();
    var game = new GameOfLifeGrid(151, 151, lifewiki_str);
    var $tds = [];

    var $grid = $("#grid");
    _(game.num_rows).times(function(x) {
      $grid.append("<tr id='x" + x + "'/>");
      var row = [];
      _(game.num_cols).times(function(y) {
        $("#x" + x).append("<td id='y" + y + "'/>");
        var v = $("#x" + x + " #y" + y);
        console.log(v)
        row.push(v);
      });
      $tds.push(row);
    });

    var cycle = 0;
    var sleep = 20;

    function any_cells_are_alive() {
      var retval = false;
      _(game.num_rows).times(function(x) {
        if (retval == true) {
          return;
        }
        _(game.num_cols).times(function(y) {
          if (game.get(x, y).has_living_cell()) {
            retval = true;
            return;
          }
        });
      });
      return retval;
    }

    var prev_state = null;

    function main_loop() {
      if(any_cells_are_alive()) {
        _(game.num_rows).times(function(x) {
          _(game.num_cols).times(function(y) {
            var ecology = game.get(x, y);
            var new_state_bin = ecology.has_living_cell() ? 1 : 0;
            var changed = prev_state == null || 
                          new_state_bin != prev_state[x][y];
            if (changed) {
              var $cell = $tds[x][y];
              if (ecology.has_living_cell()) {
                $cell.css("background-color", "green");
              } else {
                $cell.css("background-color", "white");
              }
            }
          });
        });
        $("#gen").html(cycle);
        prev_state = game.state();
        game.iterate();
        cycle++;
        _.delay(main_loop, sleep);
      }
    }

    main_loop();
  </script>

</html>


